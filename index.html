<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Survey Parkir</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  html, body{
  width:100%;
  max-width:100%;
  overflow-x:hidden;
}

:root{
  --bg:#1c1c1c;
  --card:#ffffff;
  --text:#ffffff;
  --muted:#bdbdbd;
  --accent:#ff7a18;
  --danger:#e53935;
  --radius:14px;
}

body{
  margin:0;
  padding:16px;
  font-family:system-ui, sans-serif;
  background:var(--bg);
  color:var(--text);
}

h1,h3{
  margin:0 0 10px;
}

.card{
  background:var(--card);
  color:#111;
  padding:16px;
  border-radius:16px;
  margin-bottom:16px;
  overflow:hidden;          /* üî¥ PENTING */
}




label{
  display:block;
  font-size:13px;
  color:#444;
  margin-top:10px;
}

input,
select{
  box-sizing:border-box;
  width:100%;
  max-width:100%;
  height:44px;
  padding:0 12px;
  border-radius:12px;
  border:1px solid #d0d0d0;
  font-size:15px;
  background:#f5f5f5;
  appearance:none;
  -webkit-appearance:none;
}

select{
  background-image:none;
}


button{
  width:100%;
  height:48px;
  margin-top:12px;
  border:none;
  border-radius:12px;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
}

.btn-primary{
  background:var(--accent);
  color:#fff;
}

.btn-out{
  background:var(--danger);
  color:#fff;
  height:40px;
  font-size:14px;
}


table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}

th,td{
  border-bottom:1px solid #ddd;
  padding:6px;
  text-align:center;
}

th{
  background:#f3f3f3;
}
.header{
  margin-bottom:16px;
}

.header h1{
  font-size:22px;
  font-weight:700;
  margin:0;
  color:#fff;
}

/* rapikan card form */
.card + .card{
  margin-top:12px;
}

/* kecilkan tombol agar tidak ‚Äúnabrak‚Äù */
button{
  width:100%;
  height:44px;
  border-radius:12px;
}


/* pisahkan tombol */
.card button + button{
  margin-top:8px;
}

/* section title */
.section-title{
  margin:20px 0 8px;
  font-size:18px;
  font-weight:600;
  color:#fff;
}

/* tabel mobile friendly */
table{
  font-size:12px;
}

th, td{
  padding:8px 4px;
}

/* biar tabel tidak terlalu mepet */
.card table{
  margin-top:6px;
}
.app-credit{
  position:fixed;
  bottom:6px;
  right:10px;
  font-size:11px;
  color:rgba(255,255,255,0.45);
  pointer-events:none;
  user-select:none;
}

</style>

</head>

<body>
  
<div class="header">
  <h1>Survey Parkir</h1>
</div>
<div class="card">
    <label>Nama Surveyor</label>
  <input id="surveyor" placeholder="Nama surveyor">
  <label>Jenis Kendaraan</label>
  <select id="jenis">
  <option value="SM">SM ‚Äì Sepeda Motor</option>
  <option value="MP">MP ‚Äì Mobil Penumpang</option>
  <option value="KB">KB ‚Äì Kendaraan Besar</option>
  <option value="KTB">KTB ‚Äì Kendaraan Tidak Bermotor</option>
</select>


  <label>Ciri-ciri Kendaraan (opsional)</label>
  <input id="plat" placeholder="warna, tipe, muatan, dll">

  <button class="btn-primary" onclick="parkirMasuk()">‚ûï Masuk Parkir</button>
  <button class="btn-out" onclick="resetData()">‚ü≤ Reset Data</button>


</div>

<div class="card">
  <div class="section-title">Sedang Parkir</div>

  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Jenis</th>
        <th>Masuk</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody id="aktif"></tbody>
  </table>
</div>

<div class="card">
  <div class="section-title">Selesai Parkir</div>

  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Jenis</th>
        <th>Masuk</th>
        <th>Keluar</th>
        <th>Menit</th>
      </tr>
    </thead>
    <tbody id="selesai"></tbody>
  </table>
</div>


<script>
const SHEET_URL = "https://script.google.com/macros/s/AKfycbxxmuULGgzuR7J-1hQ1FJLMuQPdGvmuMe5r5uPmxKI1XTW8hKAZmnnWmfbqs3-x56wY/exec";

let aktif = JSON.parse(localStorage.getItem("parkirAktif")) || [];
let selesai = JSON.parse(localStorage.getItem("parkirSelesai")) || [];
let idCounter = Number(localStorage.getItem("parkirID")) || 1;
const surveyorInput = document.getElementById("surveyor");

// load saat buka
surveyorInput.value = localStorage.getItem("namaSurveyor") || "";

// simpan saat diketik
surveyorInput.addEventListener("input", () => {
  localStorage.setItem("namaSurveyor", surveyorInput.value);
});

function waktu(){
  return new Date().toLocaleTimeString("id-ID");
}

function simpan(){
  localStorage.setItem("parkirAktif", JSON.stringify(aktif));
  localStorage.setItem("parkirSelesai", JSON.stringify(selesai));
  localStorage.setItem("parkirID", idCounter);
}

function resetData(){
  if(!confirm("Yakin ingin reset SEMUA data parkir? Data tidak bisa dikembalikan.")){
    return;
  }

  aktif = [];
  selesai = [];
  idCounter = 1;

  localStorage.removeItem("parkirAktif");
  localStorage.removeItem("parkirSelesai");
  localStorage.removeItem("parkirID");

  render();
}

function parkirMasuk(){
  aktif.push({
    id: idCounter++,
    jenis: jenis.value,
    plat: plat.value,
    masuk: new Date()
  });
  plat.value="";
  simpan();
  render();
}

function parkirKeluar(id){
  let i = aktif.findIndex(x=>x.id===id);
  let data = aktif.splice(i,1)[0];
  let keluar = new Date();
  let durasi = Math.round((keluar - data.masuk)/60000);

  let payload = {
    surveyor: localStorage.getItem("namaSurveyor") || "",
    jenis: data.jenis,
    ciri: data.plat || "",
    masuk: new Date(data.masuk).toLocaleString("id-ID"),
    keluar: keluar.toLocaleString("id-ID"),
    durasi: durasi
  };

  fetch(SHEET_URL, {
    method: "POST",
    body: JSON.stringify(payload)
  }).catch(err => console.error("Gagal kirim ke Google Sheet", err));

  selesai.push({...data, keluar, durasi});
  simpan();
  render();
}


function render(){
  aktifEl.innerHTML="";
  selesaiEl.innerHTML="";

  aktif.forEach(d=>{
    aktifEl.innerHTML += `
      <tr>
        <td>${d.id}</td>
        <td>${d.jenis}</td>
        <td>${d.plat||"-"}</td>
        <td>${new Date(d.masuk).toLocaleTimeString("id-ID")
}</td>
        <td><button class="btn-out" onclick="parkirKeluar(${d.id})">Keluar</button></td>
      </tr>`;
  });

  selesai.forEach(d=>{
    selesaiEl.innerHTML += `
      <tr>
        <td>${d.id}</td>
        <td>${d.jenis}</td>
        <td>${d.plat||"-"}</td>
        <td>${new Date(d.masuk).toLocaleTimeString("id-ID")}</td>
        <td>${new Date(d.keluar).toLocaleTimeString("id-ID")}</td>
        <td>${d.durasi}</td>
      </tr>`;
  });
}

const aktifEl = document.getElementById("aktif");
const selesaiEl = document.getElementById("selesai");

render();
</script>
<div class="app-credit">
  app created by N4yr4
</div>

</body>
</html>
