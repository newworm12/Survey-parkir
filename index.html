<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Survey Parkir</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  html, body{
  width:100%;
  max-width:100%;
  overflow-x:hidden;
}

:root{
  --bg:#1c1c1c;
  --card:#ffffff;
  --text:#ffffff;
  --muted:#bdbdbd;
  --accent:#ff7a18;
  --danger:#e53935;
  --radius:14px;
}

body{
  margin:0;
  padding:16px;
  font-family:system-ui, sans-serif;
  background:var(--bg);
  color:var(--text);
}

h1,h3{
  margin:0 0 10px;
}

.card{
  background:var(--card);
  color:#111;
  padding:16px;
  border-radius:16px;
  margin-bottom:16px;
  overflow:hidden;          /* üî¥ PENTING */
}




label{
  display:block;
  font-size:13px;
  color:#444;
  margin-top:10px;
}

input,
select{
  box-sizing:border-box;
  width:100%;
  max-width:100%;
  height:44px;
  padding:0 12px;
  border-radius:12px;
  border:1px solid #d0d0d0;
  font-size:15px;
  background:#f5f5f5;
  appearance:none;
  -webkit-appearance:none;
}

select{
  background-image:none;
}


button{
  width:100%;
  height:48px;
  margin-top:12px;
  border:none;
  border-radius:12px;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
}

.btn-primary{
  background:var(--accent);
  color:#fff;
}

.btn-out{
  background:var(--danger);
  color:#fff;
  height:40px;
  font-size:14px;
}


table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}

th,td{
  border-bottom:1px solid #ddd;
  padding:6px;
  text-align:center;
}

th{
  background:#f3f3f3;
}
.header{
  margin-bottom:16px;
}

.header h1{
  font-size:22px;
  font-weight:700;
  margin:0;
  color:#fff;
}

/* rapikan card form */
.card + .card{
  margin-top:12px;
}

/* kecilkan tombol agar tidak ‚Äúnabrak‚Äù */
button{
  width:100%;
  height:44px;
  border-radius:12px;
}


/* pisahkan tombol */
.card button + button{
  margin-top:8px;
}

/* section title */
.section-title{
  margin:20px 0 8px;
  font-size:18px;
  font-weight:600;
  color:#fff;
}

/* tabel mobile friendly */
table{
  font-size:12px;
}

th, td{
  padding:8px 4px;
}

/* biar tabel tidak terlalu mepet */
.card table{
  margin-top:6px;
}
.app-credit{
  position:fixed;
  bottom:6px;
  right:10px;
  font-size:11px;
  color:rgba(255,255,255,0.45);
  pointer-events:none;
  user-select:none;
}
header .subtitle{
  font-size:11px;
  color:var(--muted);
  margin-top:2px;
}
.flow-bar{
  display:grid;
  grid-template-columns: 1fr auto auto;
  gap:10px;
  align-items:center;
  padding:12px;
  background:#141414;
  border-radius:14px;
  margin-bottom:8px;
}

/* dropdown */
.flow-select select{
  height:42px;                 /* ‚¨ÖÔ∏è SAMA DENGAN TOMBOL */
  line-height:42px;            /* ‚¨ÖÔ∏è PUSAT TEKS */
  background:#2b2b2b;
  color:#fff;
  border:1px solid #444;
  border-radius:12px;
  font-weight:600;
  padding:0 14px;
}


/* tombol arus */
.flow-btn{
  height:42px;
  padding:0 16px;
  border-radius:12px;
  font-size:14px;
  font-weight:700;
  color:#fff;
}

/* MASUK = ORANGE */
.flow-btn.masuk{
  background:#ff7a18;
}

/* KELUAR = MERAH GELAP */
.flow-btn.keluar{
  background:#e53935;
}


.flow-result{
  display:flex;
  justify-content:space-between;
  font-size:12px;
  color:#fff;
  padding:0 4px 10px;
}


  
</style>

</head>

<body>
 

  <script>
function hashPin(pin){
  return btoa(pin); // cukup untuk invalidasi
}
</script>

<script>
const ACCESS_PIN = "111"; //GANTI PIN
const LOGIN_KEY  = "parkir_login_hash";
const TRY_KEY    = "parkir_pin_try";

const CURRENT_PIN_HASH = hashPin(ACCESS_PIN);

document.addEventListener("DOMContentLoaded", () => {
  if (localStorage.getItem(LOGIN_KEY) === CURRENT_PIN_HASH) {
    showApp();
  } else {
    askPin();
  }
});

function askPin(){
  const input = prompt("Masukkan PIN Akses");
  if (input === null) return;

  const pin = input.trim();

  if (pin === ACCESS_PIN) {
    localStorage.setItem(LOGIN_KEY, CURRENT_PIN_HASH);
    localStorage.removeItem(TRY_KEY);
    showApp();
    return;
  }

  let tries = Number(localStorage.getItem(TRY_KEY)) || 0;
  tries++;
  localStorage.setItem(TRY_KEY, tries);

  let msg = "pin anda salah üòá";
  if (tries === 2) msg = "masih salah‚ò∫Ô∏è";
  else if (tries === 3) msg = "PIN SALAH üôÇ";
  else if (tries === 4) msg = "PIN MASIH SALAH ‚òπÔ∏è";
  else if (tries === 5) msg = "BISA NULIS G SIH! üòí";
  else if (tries === 6) msg = "TANYA ORANG COBA ü´©";
  else if (tries === 7) msg = "UDAH NANYA BELUM ? üòë";
  else if (tries === 8) msg = "BISA GAKK !! ";
  else if (tries === 9) msg = "NYERAH AJA G SIH";
  else if (tries >= 10) msg = "üòë";


  alert(msg);
  askPin();
}

function showApp(){
  document.getElementById("app").style.display = "block";
  initFlow(); // ‚¨ÖÔ∏è INI WAJIB
}


  
</script>





<div id="app" style="display:none">

  <div class="header">
  <h1>Survey Parkir</h1>
  <div class="subtitle">Kelas E</div>
</div>
<div class="card">
    <label>Nama Surveyor</label>
  <input id="surveyor" placeholder="Nama surveyor">
  <label>Jenis Kendaraan</label>
  <select id="jenis">
  <option value="SM">SM ‚Äì Sepeda Motor</option>
  <option value="MP">MP ‚Äì Mobil Penumpang</option>
  <option value="KB">KB ‚Äì Kendaraan Besar</option>
  <option value="KTB">KTB ‚Äì Kendaraan Tidak Bermotor</option>
</select>


  <label>Ciri-ciri Kendaraan (opsional)</label>
  <input id="plat" placeholder="warna, tipe, muatan, dll">

  <button class="btn-primary" onclick="parkirMasuk()">‚ûï Masuk Parkir</button>
  <button class="btn-out" onclick="resetData()">‚ü≤ Reset Data</button>


</div>
  
<div class="flow-bar">
  <div class="flow-select">
    <select id="flowJenis">
      <option value="SM">SM</option>
      <option value="MP">MP</option>
      <option value="KB">KB</option>
      <option value="KTB">KTB</option>
    </select>
  </div>

  <button class="flow-btn masuk" onclick="countMasuk()">MASUK</button>
  <button class="flow-btn keluar" onclick="countKeluar()">KELUAR</button>
</div>

<div id="arusWrapper" style="
  display:flex;
  justify-content:space-between;
  font-size:12px;
  color:#ccc;
  padding:4px 6px 10px;
">
  <div id="arusMasukText">
    SM 0 | MP 0 | KB 0 | KTB 0
  </div>
  <div id="arusKeluarText">
    SM 0 | MP 0 | KB 0 | KTB 0
  </div>
</div>



<div class="card">
  <div class="section-title">Sedang Parkir</div>

  <table>
    <thead>
  <tr>
    <th>ID</th>
    <th>Jenis</th>
    <th>Ciri</th>   <!-- ‚¨ÖÔ∏è TAMBAHKAN DI SINI -->
    <th>Masuk</th>
    <th>Aksi</th>
  </tr>
</thead>

    <tbody id="aktif"></tbody>
  </table>
</div>

<div class="card">
  <div class="section-title">Selesai Parkir</div>

  <table>
    <thead>
  <tr>
    <th>ID</th>
    <th>Jenis</th>
    <th>Ciri</th>   <!-- ‚¨ÖÔ∏è TAMBAHKAN DI SINI -->
    <th>Masuk</th>
    <th>Aksi</th>
  </tr>
</thead>

    <tbody id="selesai"></tbody>
  </table>
</div>


<script>
const SHEET_URL = "https://script.google.com/macros/s/AKfycbxxmuULGgzuR7J-1hQ1FJLMuQPdGvmuMe5r5uPmxKI1XTW8hKAZmnnWmfbqs3-x56wY/exec";

let aktif = JSON.parse(localStorage.getItem("parkirAktif")) || [];
let selesai = JSON.parse(localStorage.getItem("parkirSelesai")) || [];
let idCounter = Number(localStorage.getItem("parkirID")) || 1;
const surveyorInput = document.getElementById("surveyor");

// load saat buka
surveyorInput.value = localStorage.getItem("namaSurveyor") || "";

// simpan saat diketik
surveyorInput.addEventListener("input", () => {
  localStorage.setItem("namaSurveyor", surveyorInput.value);
});

function waktu(){
  return new Date().toLocaleTimeString("id-ID");
}

function simpan(){
  localStorage.setItem("parkirAktif", JSON.stringify(aktif));
  localStorage.setItem("parkirSelesai", JSON.stringify(selesai));
  localStorage.setItem("parkirID", idCounter);
}

function resetData(){
  if(!confirm("Yakin ingin reset SEMUA data parkir ü•∫ ")){
    return;
  }

  aktif = [];
  selesai = [];
  idCounter = 1;

  localStorage.removeItem("parkirAktif");
  localStorage.removeItem("parkirSelesai");
  localStorage.removeItem("parkirID");

  render();
}

function parkirMasuk(){
  aktif.push({
    id: idCounter++,
    jenis: jenis.value,
    plat: plat.value,
    masuk: new Date()
  });
  plat.value="";
  simpan();
  render();
}

function parkirKeluar(id){
  let i = aktif.findIndex(x=>x.id===id);
  let data = aktif.splice(i,1)[0];
  let keluar = new Date();
  let durasi = Math.round((keluar - data.masuk)/60000);

  let payload = {
  surveyor: localStorage.getItem("namaSurveyor") || "",
  jenis: data.jenis,
  ciri: data.plat || "",
  masuk: new Date(data.masuk).toLocaleString("id-ID"),
  keluar: keluar.toLocaleString("id-ID"),
  durasi: durasi,
  arus_masuk: 1,
  arus_keluar: 1
};

  fetch(SHEET_URL, {
    method: "POST",
    body: JSON.stringify(payload)
  }).catch(err => console.error("Gagal kirim ke Google Sheet", err));

  selesai.push({...data, keluar, durasi});
  simpan();
  render();
}


function render(){
  aktifEl.innerHTML="";
  selesaiEl.innerHTML="";

  aktif.forEach(d=>{
    aktifEl.innerHTML += `
      <tr>
        <td>${d.id}</td>
        <td>${d.jenis}</td>
        <td>${d.plat||"-"}</td>
        <td>${new Date(d.masuk).toLocaleTimeString("id-ID")
}</td>
        <td><button class="btn-out" onclick="parkirKeluar(${d.id})">Keluar</button></td>
      </tr>`;
  });

  selesai.forEach(d=>{
    selesaiEl.innerHTML += `
      <tr>
        <td>${d.id}</td>
        <td>${d.jenis}</td>
        <td>${d.plat||"-"}</td>
        <td>${new Date(d.masuk).toLocaleTimeString("id-ID")}</td>
        <td>${new Date(d.keluar).toLocaleTimeString("id-ID")}</td>
        <td>${d.durasi}</td>
      </tr>`;
  });
}

const aktifEl = document.getElementById("aktif");
const selesaiEl = document.getElementById("selesai");

render();
</script>
  </div> <!-- end #app -->

<div class="app-credit">
  WEB created by N4yr4
</div>
<script>
let flowCount;

function initFlow(){
  flowCount = JSON.parse(localStorage.getItem("flowCount")) || {
    SM:0, MP:0, KB:0, KTB:0
  };

  window.smCount  = document.getElementById("smCount");
  window.mpCount  = document.getElementById("mpCount");
  window.kbCount  = document.getElementById("kbCount");
  window.ktbCount = document.getElementById("ktbCount");

  updateFlowUI();
}

function updateFlowUI(){
  smCount.textContent  = flowCount.SM;
  mpCount.textContent  = flowCount.MP;
  kbCount.textContent  = flowCount.KB;
  ktbCount.textContent = flowCount.KTB;
  localStorage.setItem("flowCount", JSON.stringify(flowCount));
}
let arusMasukCounter = {
  SM: 0,
  MP: 0,
  KB: 0,
  KTB: 0
};

let arusKeluarCounter = {
  SM: 0,
  MP: 0,
  KB: 0,
  KTB: 0
};


function updateArusText(){
  document.getElementById("arusMasukText").innerText =
    `SM ${arusMasukCounter.SM} | MP ${arusMasukCounter.MP} | KB ${arusMasukCounter.KB} | KTB ${arusMasukCounter.KTB}`;

  document.getElementById("arusKeluarText").innerText =
    `SM ${arusKeluarCounter.SM} | MP ${arusKeluarCounter.MP} | KB ${arusKeluarCounter.KB} | KTB ${arusKeluarCounter.KTB}`;
}


function countMasuk(){
  const jenis = document.getElementById("flowJenis").value;

  arusMasukCounter[jenis]++;
  updateArusText();

  kirimArus(1, 0);
}


function countKeluar(){
  const jenis = document.getElementById("flowJenis").value;

  arusKeluarCounter[jenis]++;
  updateArusText();

  kirimArus(0, 1);
}


function kirimArus(masuk, keluar){
  fetch(SHEET_URL, {
    method: "POST",
    body: JSON.stringify({
      mode: "ARUS",
      waktu: new Date().toLocaleString("id-ID"),
      masuk: masuk,
      keluar: keluar
    })
  }).catch(err => console.error("Gagal kirim arus", err));
}


</script>


</body>
</html>
